(function(e){"use strict";function t(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function n(e,n){this.el=e,this.options=t({},this.options),t(this.options,n),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.current_menu=0;var i;this.menus.forEach(function(e,t){var n=e.querySelectorAll(".menu__item");n.forEach(function(e,n){var r=e.querySelector(".menu__link--current");r&&(i=t)})}),i&&(this.current_menu=i),this._init()}var i={animations:Modernizr.cssanimations},r={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},a=r[Modernizr.prefixed("animation")],s=function(e,t){var n=function(e){if(i.animations){if(e.target!=this)return;this.removeEventListener(a,n)}t&&"function"==typeof t&&t.call()};i.animations?e.addEventListener(a,n):n()};n.prototype.options={breadcrumbsCtrl:!0,initialBreadcrumb:"all",backCtrl:!0,itemsDelayInterval:60,direction:"r2l",onItemClick:function(e,t){return!1}},n.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var e=this,t=[];this.menus.forEach(function(n,i){var r={menuEl:n,menuItems:[].slice.call(n.querySelectorAll(".menu__item"))};e.menusArr.push(r),i===e.current_menu&&classie.add(n,"menu__level--current");var a=(n.getAttribute("data-menu"),n.querySelectorAll(".menu__link"));a.forEach(function(e,n){var r=e.getAttribute("data-submenu");if(r){var a={menu:r,name:e.innerHTML};t[i]?t[i].push(a):(t[i]=[],t[i].push(a))}})}),this.menus.forEach(function(n,i){var r=n.getAttribute("data-menu");t.forEach(function(t,n){t.forEach(function(t,a){t.menu==r&&(e.menusArr[i].backIdx=n,e.menusArr[i].name=t.name)})})}),e.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.breadcrumbsCtrl.setAttribute("aria-label","You are here"),this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),0!=e.menusArr[e.current_menu].backIdx&&0!=e.current_menu&&(this._crawlCrumbs(e.menusArr[e.current_menu].backIdx,e.menusArr),this.breadCrumbs=!0),0!=e.current_menu&&(this._addBreadcrumb(e.current_menu),this.breadCrumbs=!0)),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML='<span class="icon icon--arrow-left"></span>',this.el.insertBefore(this.backCtrl,this.el.firstChild)),this._initEvents()},n.prototype._initEvents=function(){for(var e=this,t=0,n=this.menusArr.length;t<n;++t)this.menusArr[t].menuItems.forEach(function(t,n){t.querySelector("a").addEventListener("click",function(t){var i=t.target.getAttribute("data-submenu"),r=t.target.innerHTML,a=e.el.querySelector('ul[data-menu="'+i+'"]');if(i&&a)t.preventDefault(),e._openSubMenu(a,n,r);else{var s=e.el.querySelector(".menu__link--current");s&&classie.remove(e.el.querySelector(".menu__link--current"),"menu__link--current"),classie.add(t.target,"menu__link--current"),e.options.onItemClick(t,r)}})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){e._back()})},n.prototype._openSubMenu=function(e,t,n){return!this.isAnimating&&(this.isAnimating=!0,this.menusArr[this.menus.indexOf(e)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(e)].name=n,this._menuOut(t),void this._menuIn(e,t))},n.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var e=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(e),this.options.breadcrumbsCtrl&&this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild)},n.prototype._menuOut=function(e){var t=this,n=this.menusArr[this.current_menu].menuEl,i="undefined"==typeof e;this.menusArr[this.current_menu].menuItems.forEach(function(n,r){n.style.WebkitAnimationDelay=n.style.animationDelay=i?parseInt(r*t.options.itemsDelayInterval)+"ms":parseInt(Math.abs(e-r)*t.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?classie.add(n,i?"animate-outToRight":"animate-outToLeft"):classie.add(n,i?"animate-outToLeft":"animate-outToRight")},n.prototype._menuIn=function(e,t){var n=this,i=this.menusArr[this.current_menu].menuEl,r="undefined"==typeof t,a=this.menus.indexOf(e),u=this.menusArr[a],e=u.menuEl,m=u.menuItems,o=m.length;m.forEach(function(u,m){u.style.WebkitAnimationDelay=u.style.animationDelay=r?parseInt(m*n.options.itemsDelayInterval)+"ms":parseInt(Math.abs(t-m)*n.options.itemsDelayInterval)+"ms";var c=t<=o/2||r?o-1:0;m===c&&s(u,function(){"r2l"===n.options.direction?(classie.remove(i,r?"animate-outToRight":"animate-outToLeft"),classie.remove(e,r?"animate-inFromLeft":"animate-inFromRight")):(classie.remove(i,r?"animate-outToLeft":"animate-outToRight"),classie.remove(e,r?"animate-inFromRight":"animate-inFromLeft")),classie.remove(i,"menu__level--current"),classie.add(e,"menu__level--current"),n.current_menu=a,r?0===n.current_menu&&n.options.backCtrl&&classie.add(n.backCtrl,"menu__back--hidden"):(n.options.backCtrl&&classie.remove(n.backCtrl,"menu__back--hidden"),n._addBreadcrumb(a)),n.isAnimating=!1,e.focus()})}),"r2l"===this.options.direction?classie.add(e,r?"animate-inFromLeft":"animate-inFromRight"):classie.add(e,r?"animate-inFromRight":"animate-inFromLeft")},n.prototype._addBreadcrumb=function(e){if(!this.options.breadcrumbsCtrl)return!1;var t=document.createElement("a");t.href="#",t.innerHTML=e?this.menusArr[e].name:this.options.initialBreadcrumb,this.breadcrumbsCtrl.appendChild(t);var n=this;t.addEventListener("click",function(i){if(i.preventDefault(),!t.nextSibling||n.isAnimating)return!1;n.isAnimating=!0,n._menuOut();var r=n.menusArr[e].menuEl;n._menuIn(r);for(var a;a=t.nextSibling;)n.breadcrumbsCtrl.removeChild(a)})},n.prototype._crawlCrumbs=function(e,t){0!=t[e].backIdx&&this._crawlCrumbs(t[e].backIdx,t),this._addBreadcrumb(e)},e.MLMenu=n})(window);